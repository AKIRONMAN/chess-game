<link rel="stylesheet" type="text/css" href="t.css"/>
	<style>
	</style>
	<div class="mainlist" id="list" style="margin:0%;position:absolute;">
		<h1>Chose Any Player</h1>
			<div id="mlist">
			</div>
	</div>
	<div class="h" id="h" style="margin-left:40%;">
	<input type="text" id="name" name="h"/>
	<input type="button" onclick="set();"/>
	</div>
	<div class="h1" id="h1" style="margin-left:50%;margin-top:20%;">
	<input type="text" id="name" name="h"/>
	<input type="button" onclick="set();"/>
	</div>
	<script>
		var namep1;
		var list;
		var ttrun;
		var trun="W";
		var namep2;
		var cot;
		var checkR=setInterval(checkR,700);
		var checkA=setInterval(checkA,1000);
		var movetrun;
		var h1=document.getElementById("h1");
		var h=document.getElementById("h");
		
		window.onload =function(){
			trun="W";
			load();
			refresh();
			list=setInterval(load,500);
		}
		function set(){
			var name=document.getElementById("name");
			namep1=name.value;	
		}
		function load(){
			var xml= new XMLHttpRequest();
			var no=document.getElementById("mlist");
			var n=no.getElementsByClassName("l");
			xml.onreadystatechange=function(){
				if(xml.responseText==""){}
				else{
					document.getElementById("mlist").innerHTML=xml.responseText;
				}
			}
			xml.open("GET","load.php?load=1&n="+n.length,true);
			xml.send();
		}
		function refresh(){
			var xml= new XMLHttpRequest();
			var no=document.getElementById("mlist");
			var n=no.getElementsByClassName("l");
			xml.onreadystatechange=function(){
				if(xml.responseText=="" || xml.responseText==" " || xml.responseText=="undefined"){}
				else{
					var moves=xml.responseText.split("|");
					var p1=moves[2].split("-");
					var p2=moves[3].split("-");
					kq("king",p1[0],p2[0],moves[0]);
					kq("queen",p1[1],p2[1],moves[0]);
					pwan("pwan",p1[5],p2[5],moves[0]);
					brk("bishop",p1[2],p2[2],moves[0]);
					brk("rook",p1[3],p2[3],moves[0]);
					brk("knight",p1[4],p2[4],moves[0]);
					console.log(moves[0]);
				}
			}
			xml.open("GET","refresh.php?refresh=1",true);
			xml.send();
		}
		function kq(namev,p1,p2,colorp1,colorp2){
			var n=0,ch=0;
			var p1c,p2c;
			if(colorp1=="W"){
				p1c="white";
				p2c="black";
			}else{
				p2c="white";
				p1c="black";
			}
			while(n<2){
				var c,d,Vking;
				if(n==0){
						Vking=p1.split(":");
						c=p1c;
						d=colorp1;
				}else{
						Vking=p2.split(":");
						c=p2c;
						d=colorp2;
				}
				if(Vking[0]!="a"){
					tdc[Vking[2]].innerHTML="";
					m="<font color='"+c+"' style="+"'position:absolute;'"+ "onclick="+"fun("+Vking[1]+","+(Vking[0]+1)+",'"+namev+"','"+d+"','"+ch+"','"+Vking[3]+"');>&#"+Vking[3]+";</font>";
					tdc[Vking[0]].innerHTML=m;
				}else{}
				n++;
			}
		}
		function brk(namev,p1,p2,colorp1){
			var n=0,ch=0;
			var p1c,p2c;
			if(colorp1=="W"){
				p1c="white";
				p2c="black";
			}else{
				p2c="white";
				p1c="black";
			}
			while(n<2){
				var Vking,Valk,setval;
				var c,d,v=0;
				if(n==0){
					while(v<2){ 
						 Valk=p1.split(",");
						 Vking=Valk[0].split(":"); 
						 Vking2=Valk[1].split(":"); 
						 c=p1c;
						 d=colorp1;
						 if(v==0){
							setval=Vking;
						 }else{
							setval=Vking2;
						 }
						if(setval[0]!="a"){
							tdc[setval[2]].innerHTML="";
							m="<font color='"+c+"' style="+"'position:absolute;'"+ "onclick="+"fun("+setval[1]+","+(setval[0]+1)+",'"+namev+"','"+d+"','"+ch+"','"+setval[3]+"');>&#"+setval[3]+";</font>";
							tdc[setval[0]].innerHTML=m;
						}else{}
						v++;
					}
				}else{
					while(v<2){ 
						 Valk=p2.split(",");
						 Vking=Valk[0].split(":"); 
						 Vking2=Valk[1].split(":"); 
						 c=p2c;
						 d=colorp2;
						 if(v==0){
							setval=Vking;
						 }else{
							setval=Vking2;
						 }
						if(setval[0]!="a"){
							tdc[setval[2]].innerHTML="";
							m="<font color='"+c+"' style="+"'position:absolute;'"+ "onclick="+"fun("+setval[1]+","+(setval[0]+1)+",'"+namev+"','"+d+"','"+ch+"','"+setval[3]+"');>&#"+setval[3]+";</font>";
							tdc[setval[0]].innerHTML=m;
						}else{}
						v++;
					}
				}
				n++;
			}
		}
		function pwan(namev,p1,p2,colorp1){
			var n=0,ch=0;
			var p1c,p2c;
			if(colorp1=="W"){
				p1c="white";
				p2c="black";
			}else{
				p2c="white";
				p1c="black";
			}
			while(n<2){
				var Vking,Valk,setval;
				var c,d,v=0;
				if(n==0){
					while(v<9){ 
						 Valk=p1.split(",");
						 Vking=Valk[0].split(":"); 
						 Vking2=Valk[1].split(":"); 
						 c=p1c;
						 d=colorp1;
						 if(v==0){
							setval=Vking;
						 }else{
							setval=Vking2;
						 }
						if(setval[0]!="a"){
							tdc[setval[2]].innerHTML="";
							m="<font color='"+c+"' style="+"'position:absolute;'"+ "onclick="+"fun("+setval[1]+","+(setval[0]+1)+",'"+namev+"','"+d+"','"+ch+"','"+setval[3]+"');>&#"+setval[3]+";</font>";
							tdc[setval[0]].innerHTML=m;
						}else{}
						v++;
					}
				}else{
					while(v<8){ 
						 Valk=p2.split(",");
						 Vking=Valk[0].split(":"); 
						 Vking2=Valk[1].split(":"); 
						 c=p2c;
						 d=colorp2;
						 if(v==0){
							setval=Vking;
						 }else{
							setval=Vking2;
						 }
						if(setval[0]!="a"){
							tdc[setval[2]].innerHTML="";
							m="<font color='"+c+"' style="+"'position:absolute;'"+ "onclick="+"fun("+setval[1]+","+(setval[0]+1)+",'"+namev+"','"+d+"','"+ch+"','"+setval[3]+"');>&#"+setval[3]+";</font>";
							tdc[setval[0]].innerHTML=m;
						}else{}
						v++;
					}
				}
				n++;
			}
		}
		function request(name){
			namep2=name;
			var xml= new XMLHttpRequest();
			xml.onreadystatechange=function(){
				console.log(xml.responseText);
				
			}
			xml.open("GET","load.php?request=1&name="+namep2+"&nam="+namep1,true);
			xml.send();
		}
		function checkR(){
			var xml= new XMLHttpRequest();
			var no=document.getElementById("mlist");
			xml.onreadystatechange=function(){
			
				if(xml.responseText=="no"){
				}else if(xml.responseText!=""){
					var b=xml.responseText.split("-");
					var a=confirm("Do you want play with "+b[0]+"?");
					if(a==true){
						xml.open("GET","load.php?Accepted=1&nam="+namep1,true);
						ttrun=b[1];
						trun="a";
						start=1;
						cot=2;
						clearInterval(checkA);
						clearInterval(checkR);
					}else{
						xml.open("GET","load.php?Unaccepted=1&nam="+namep1,true);
					}
					xml.send();
				}
				else{}
			}
			xml.open("GET","load.php?checkR=1&nam="+namep1,true);
			xml.send();
		}
		function checkA(){
			var xml= new XMLHttpRequest();
			var no=document.getElementById("mlist");
			xml.onreadystatechange=function(){
				if(xml.responseText=="no"){
				}else if(xml.responseText!=""){
					if(xml.responseText=="deniend"){
						alert(xml.responseText+"not is ready to play with you!");
					}else{
						alert(xml.responseText+"is ready to play with you!");
						namep2=xml.responseText;
						ttrun=trun;
						start=1;
						cot=0;
						movetrun = setInterval(movetrun,1000);
						clearInterval(checkA);
						clearInterval(checkR);
					}
				}else{}
			}
			xml.open("GET","load.php?checkA=1&nam="+namep1,true);
			xml.send();
		}
	function movetrun(){
		var colorT,t,checkp1=0;
		if(ttrun=="W"){
			colorT="black";
			t="B";
		}else{
			colorT="white";
			t="W";
		}
		if(trun!="a"){
			var xml=new XMLHttpRequest();
			xml.onreadystatechange=function(){
				if(xml.responseText=="" || xml.responseText==" " || xml.responseText=="undefined"){}
				else{
					if(cot==2){
						clearInterval(movetrun);
					}
					else{
						var b=xml.responseText.split("-");
						h.innerHTML=b;
						m="<font color='"+colorT+"' style="+"'position:absolute;'"+ "onclick="+"fun("+b[2]+","+b[1]+",'"+b[0]+"','"+t+"','"+checkp1+"','"+b[4]+"');>&#"+b[4]+";</font>";
						h1.innerHTML=m;
						cot++;
					}
				}
			}
			xml.open("GET","turn.php?trun=1&name="+namep2+"&nam="+namep1,true);
			xml.send();
		}else{}
	}
		
	</script>
